<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>交易规模</title>
  <link rel="stylesheet" href="../css/tradeScale.css" />
</head>

<body>
  <div class="warp-container">
    <!-- 头部 start -->
    <div class="header-box">
      <a href="./index.html"><img class="back-icon" src="../images/back.svg" alt=""></a>
      <div class="header-title">
        <img class="header-icon" src="../images/header_icon.png" alt="">
        <span>交易规模</span>
        <img class="header-icon" src="../images/header_icon.png" alt="">
      </div>
      <div class="select-month">
        <input type="text" value="" placeholder="按月查询（2019-01）">
        <img class="calendar-icon" src="../images/calendar.png" alt="">
      </div>
    </div>
    <!-- 头部 end -->
    <div class="main-content">
      <div class="left-box">
        <!-- 分行模块 start -->
        <div class="branch">
          <img class="left-top-icon" src="../images/topLeft.png" alt="">
          <img class="right-buttom-icon" src="../images/rightButtom.png" alt="">
          <div class="name">
            <span>西宁分行</span>
          </div>
          <p><span class="current-text">当前交易量</span>&nbsp;&nbsp;&nbsp;&nbsp;<span>1,234,567</span></p>
          <p><span class="sum-text">累计交易量</span>&nbsp;&nbsp;&nbsp;&nbsp;<span>123,456,789</span></p>
        </div>
        <!-- 分行模块 end -->
        <!-- 排名模块 start -->
        <div class="trade-amount">
          <img class="left-top-icon" src="../images/topLeft.png" alt="">
          <img class="right-buttom-icon" src="../images/rightButtom.png" alt="">
          <div class="amount-item current-amount">
            <div class="name">
              <span class="current-rank">当前交易量排名</span>
            </div>
            <p class="first-rank">
              <span class="rank gold">1</span>
              <span class="num-amount"><i class="percent-width"></i></span>
              <span class="city">上海</span>
            </p>
            <p>
              <span class="rank silver">2</span>
              <span class="num-amount"><i class="percent-width"></i></span>
              <span class="city">福州</span>
            </p>
            <p>
              <span class="rank copper">3</span>
              <span class="num-amount"><i class="percent-width"></i></span>
              <span class="city">合肥</span>
            </p>
            <p>
              <span class="rank">4</span>
              <span class="num-amount"><i class="percent-width"></i></span>
              <span class="city">兰州</span>
            </p>
            <p>
              <span class="rank">5</span>
              <span class="num-amount"><i class="percent-width"></i></span>
              <span class="city">西宁</span>
            </p>
          </div>
          <div class="amount-item sum-amount">
            <div class="name">
              <span class="sum-rank">累计交易量排名</span>
            </div>
            <p class="first-rank">
              <span class="rank gold">1</span>
              <span class="num-amount"><i class="percent-width"></i></span>
              <span class="city">上海</span>
            </p>
            <p>
              <span class="rank silver">2</span>
              <span class="num-amount"><i class="percent-width"></i></span>
              <span class="city">福州</span>
            </p>
            <p>
              <span class="rank copper">3</span>
              <span class="num-amount"><i class="percent-width"></i></span>
              <span class="city">合肥</span>
            </p>
            <p>
              <span class="rank">4</span>
              <span class="num-amount"><i class="percent-width"></i></span>
              <span class="city">兰州</span>
            </p>
            <p>
              <span class="rank">5</span>
              <span class="num-amount"><i class="percent-width"></i></span>
              <span class="city">西宁</span>
            </p>
          </div>
        </div>
        <!-- 排名模块 end -->
      </div>
      <div class="right-box">
        <!-- 顶部导航 start -->
        <div class="top-nav">
          <div class="nav-item active-nav">
            <img class="edge1" src="../images/edge.png">
            <img class="edge2" src="../images/edge.png">
            <img class="edge3" src="../images/edge.png">
            <img class="edge4" src="../images/edge.png">
            <span class="name">网上银行</span>
            <span class="date">2019-01</span>
          </div>
          <div class="nav-item">
            <img class="edge1" src="../images/edge.png">
            <img class="edge2" src="../images/edge.png">
            <img class="edge3" src="../images/edge.png">
            <img class="edge4" src="../images/edge.png">
            <span class="name">手机银行</span>
            <span class="date">2019-01</span>
          </div>
          <div class="nav-item">
            <img class="edge1" src="../images/edge.png">
            <img class="edge2" src="../images/edge.png">
            <img class="edge3" src="../images/edge.png">
            <img class="edge4" src="../images/edge.png">
            <span class="name">微众银行</span>
            <span class="date">2019-01</span>
          </div>
          <div class="nav-item">
            <img class="edge1" src="../images/edge.png">
            <img class="edge2" src="../images/edge.png">
            <img class="edge3" src="../images/edge.png">
            <img class="edge4" src="../images/edge.png">
            <span class="name">百信银行</span>
            <span class="date">2019-01</span>
          </div>
          <div class="nav-item">
            <img class="edge1" src="../images/edge.png">
            <img class="edge2" src="../images/edge.png">
            <img class="edge3" src="../images/edge.png">
            <img class="edge4" src="../images/edge.png">
            <span class="name">商品客户端</span>
            <span class="date">2019-01</span>
          </div>
          <div class="nav-item">
            <img class="edge1" src="../images/edge.png">
            <img class="edge2" src="../images/edge.png">
            <img class="edge3" src="../images/edge.png">
            <img class="edge4" src="../images/edge.png">
            <span class="name">华泰证券</span>
            <span class="date">2019-01</span>
          </div>
        </div>
        <!-- 顶部导航 end -->
        <div class="center-content">
          <!-- 地图图表 start -->
          <div class="chart-data">
            <div id="echarts-box" class="chart"></div>
            <div class="tips"></div>
          </div>

          <!-- 地图图表 start -->
          <!-- 城市列表 start -->
          <div class="city-data">
            <img class="left-top-icon" src="../images/topLeft.png" alt="">
            <img class="right-buttom-icon" src="../images/rightButtom.png" alt="">
            <div class="citys"></div>
          </div>
          <!-- 城市列表 end -->
        </div>
      </div>
    </div>
  </div>
  <script type="text/javascript" src="../js/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="../js/rem.js"></script>
  <!-- 图表所需js -->
  <script type="text/javascript" src="../js/echarts.min.js"></script>
  <script type="text/javascript" src="../js/china.js"></script>
  <script type="text/javascript" src="../js/city.js"></script>
  <script type="text/javascript">
    // 当前交易量排名数据
    var currentAmount = [{
      city: '上海',
      amount: '100%'
    }, {
      city: '福州',
      amount: '80%'
    }, {
      city: '合肥',
      amount: '50%'
    }, {
      city: '兰州',
      amount: '30%'
    }, {
      city: '西宁',
      amount: '20%'
    }];
    for (var i = 0; i < currentAmount.length; i++) {
      $('.current-amount > p').eq(i).find('.percent-width').css('width', currentAmount[i].amount);
    }

    // 累计交易量排名数据
    var sumAmount = [{
      city: '上海',
      amount: '90%'
    }, {
      city: '福州',
      amount: '70%'
    }, {
      city: '合肥',
      amount: '60%'
    }, {
      city: '兰州',
      amount: '40%'
    }, {
      city: '西宁',
      amount: '30%'
    }];
    for (var i = 0; i < currentAmount.length; i++) {
      $('.sum-amount > p').eq(i).find('.percent-width').css('width', sumAmount[i].amount);
    }

    // 城市数据
    var citys = ['西宁', '西宁', '厦门', '贵阳', '西宁', '石家庄', '兰州', '合肥', '呼和浩特', '乌鲁木齐', '长春', '南宁', '南昌', '哈尔滨', '长沙', '太原',
      '青岛', '武汉', '沈阳', '西安', '成都', '济南', '大连', '郑州', '天津', '昆明', '深圳', '广州', '重庆', '苏州', '北京', '南京', '宁波', '杭州',
      '上海', ''
    ];
    $('.citys').append($('<div class="city-group group1"></div>'));
    $('.citys').append($('<div class="city-group group2"></div>'));

    // 数组为偶数,如果为奇数，请在后面插入一条空数据
    for (var j = 0; j < citys.length; j++) {
      if (j < citys.length / 2) {
        if (citys[j]) {
          $('.group1').append($('<div class="city content-center">' + (j + 1) + '. ' + citys[j] + '</div>'));
        } else {
          $('.group1').append($('<div class="city content-center" style="border:none"></div>'));
        }
      } else {
        if (citys[j]) {
          $('.group2').append($('<div class="city content-center">' + (j + 1) + '. ' + citys[j] + '</div>'));
        } else {
          $('.group2').append($('<div class="city content-center" style="border:none"></div>'));
        }
      }
    }

    // 交易量/签约客户数量切换展示
    $('.header-title').click(function () {
      if ($(this).text().indexOf('交易规模') > -1) {
        $(this).find('span').text('签约统计');
        $('.current-text').text('当前签约量');
        $('.sum-text').text('累计签约量');
        $('.current-rank').text('当前签约量排名');
        $('.sum-rank').text('累计签约量排名');
        $(".nav-item").each(function () {
          if ($(this).text().indexOf('微众') > -1 || $(this).text().indexOf('百信') > -1 || $(this).text().indexOf(
              '华泰') > -1) {
            $(this).addClass('disabled');
          }
        });
        changeData('签约')
      } else {
        $(this).find('span').text('交易规模');
        $('.current-text').text('当前交易量');
        $('.sum-text').text('累计交易量');
        $('.current-rank').text('当前交易量排名');
        $('.sum-rank').text('累计交易量排名');
        $('.nav-item').removeClass('disabled');
        changeData('交易')
      }
    })
    // 选中微众、百信、华泰
    $(".nav-item").click(function () {
      $(this).addClass("active-nav").siblings().removeClass("active-nav");
      if ($(this).text().indexOf('微众') > -1 || $(this).text().indexOf('百信') > -1 || $(this).text().indexOf('华泰') > -
        1) {
        $('.branch').hide();
        $('.city-data').hide();
        $('.trade-amount').css('margin-top', 0);
      } else {
        $('.branch').show();
        $('.city-data').show();
        $('.trade-amount').css('margin-top', '1rem');
      }
    });
  </script>

  <!-- 图表js -->
  <script type="text/javascript">
    const nameColor = " rgb(55, 75, 113)";
    const name_fontFamily = '等线';
    const subname_fontSize = 15;
    const name_fontSize = 18;
    const mapName = 'china';
    // 地图数据
    let mapData = [{
        name: '北京',
        selected: false,
        value: 1,
      },
      {
        name: '天津',
        selected: false,
        value: 2
      },
      {
        name: '上海',
        selected: false,
        value: 3
      },
      {
        name: '重庆',
        selected: false,
        value: 4
      },
      {
        name: '河北',
        selected: false,
        value: 5
      },
      {
        name: '河南',
        selected: false,
        value: 6
      },
      {
        name: '云南',
        selected: false,
        value: 7
      },
      {
        name: '辽宁',
        selected: false,
        value: 8
      },
      {
        name: '黑龙江',
        selected: false,
        value: 9
      },
      {
        name: '湖南',
        selected: false,
        value: 10
      },
      {
        name: '安徽',
        selected: false,
        value: 11
      },
      {
        name: '山东',
        selected: false,
        value: 12
      },
      {
        name: '新疆',
        selected: false,
        value: 13
      },
      {
        name: '江苏',
        selected: false,
        value: 14
      },
      {
        name: '浙江',
        selected: false,
        value: 15
      },
      {
        name: '江西',
        selected: false,
        value: 16
      },
      {
        name: '湖北',
        selected: false,
        value: 17
      },
      {
        name: '广西',
        selected: false,
        value: 18
      },
      {
        name: '甘肃',
        selected: false,
        value: 19
      },
      {
        name: '山西',
        selected: false,
        value: 20
      },
      {
        name: '内蒙古',
        selected: false,
        value: 21
      },
      {
        name: '陕西',
        selected: false,
        value: 22
      },
      {
        name: '吉林',
        selected: false,
        value: 23
      },
      {
        name: '福建',
        selected: false,
        value: 24
      },
      {
        name: '贵州',
        selected: false,
        value: 25
      },
      {
        name: '广东',
        selected: false,
        value: 26
      },
      {
        name: '青海',
        selected: false,
        value: 27
      },
      {
        name: '西藏',
        selected: false,
        value: 28
      },
      {
        name: '四川',
        selected: false,
        value: 29
      },
      {
        name: '宁夏',
        selected: false,
        value: 30
      },
      {
        name: '海南',
        selected: false,
        value: 31
      },
      {
        name: '台湾',
        selected: false,
        value: 32
      },
      {
        name: '香港',
        selected: false,
        value: 33
      },
      {
        name: '澳门',
        selected: false,
        value: 34
      }
    ];
    // 渲染数据，可以自定义组装数据
    let data = [{
        name: '西宁',
        value: 1
      },
      {
        name: '厦门',
        value: 2
      },
      {
        name: '贵阳',
        value: 3
      },
      {
        name: '南平',
        value: 4
      },
      {
        name: '石家庄',
        value: 5
      },
      {
        name: '兰州',
        value: 6
      },
      {
        name: '合肥',
        value: 7
      },
      {
        name: '呼和浩特',
        value: 8
      },
      {
        name: '乌鲁木齐',
        value: 9
      },
      {
        name: '长春',
        value: 10
      },
      {
        name: '南宁',
        value: 11
      },
      {
        name: '南昌',
        value: 12
      },
      {
        name: '哈尔滨',
        value: 13
      },
      {
        name: '长沙',
        value: 14
      },
      {
        name: '太原',
        value: 15
      },
      {
        name: '青岛',
        value: 16
      },
      {
        name: '武汉',
        value: 17
      },
      {
        name: '沈阳',
        value: 18
      },
      {
        name: '西安',
        value: 19
      },
      {
        name: '成都',
        value: 20
      },
      {
        name: '济南',
        value: 21
      },
      {
        name: '大连',
        value: 22
      },
      {
        name: '郑州',
        value: 23
      },
      {
        name: '天津',
        value: 24
      },
      {
        name: '昆明',
        value: 25
      },
      {
        name: '深圳',
        value: 26
      },
      {
        name: '广州',
        value: 27
      },
      {
        name: '重庆',
        value: 28
      },
      {
        name: '苏州',
        value: 29
      },
      {
        name: '北京',
        value: 30
      },
      {
        name: '南京',
        value: 31
      },
      {
        name: '宁波',
        value: 32
      },
      {
        name: '杭州',
        value: 33
      },
      {
        name: '上海',
        value: 34
      }
    ];

    // 以下是自定义组装数据，对应的图表中的判断要修改
    data = data.map(function (item, index) {
      item.dataType = 'trade';
      const data = {
        dataType: 'trade',
        value: {
          index: index + 1,
          value: (index + 1) * 10,
        }

      }
      return Object.assign({}, item, data)
    })

    // 切换数据源
    // $('p').click(function () {
    //   data = data.map(function (item, index) {
    //     item.dataType = 'trade';
    //     const data = {
    //       dataType: 'sign',
    //       value: {
    //         index: index + 1,
    //         sign: (index + 1) * 10,
    //         sign1: (index + 1) * 20
    //       }
    //     }
    //     return Object.assign({}, item, data)
    //   })
    //   // $('#test').html()
    //   调用切换方法
    //   changeData('签约')
    // })
    // 以下是常规定义，暂不用修改
    const geoCoordMap = {};

    function convertData(data) {
      var res = [];
      for (var i = 0; i < data.length; i++) {
        var geoCoord = geoCoordMap[data[i].name];
        if (geoCoord) {
          res.push({
            name: data[i].name,
            value: geoCoord.concat(data[i].value),
          });
        }
      }
      return res;
    };
    const myChart = echarts.init(document.getElementById('echarts-box'));
    const mapFeatures = echarts.getMap(mapName).geoJson.features; // 获取省份
    const mapFeatures2 = city.features; // 获取市
    mapFeatures.forEach(function (v) {
      // 地区名称
      const name = v.properties.name;
      // 地区经纬度
      geoCoordMap[name] = v.properties.cp;
    });
    mapFeatures2.forEach(function (v) {
      // 地区名称
      const name = v.properties.name;
      // 地区经纬度
      geoCoordMap[name] = v.properties.cp;
    });
    // 常规定义结束

    // 
    /**
     * 切换交易量，还是签约量，需要重新设置option，内容可以不变，data必须变
     * name为签约还是交易
     */
    function changeData(name) {
      const option = {
        title: {
          x: 'center',
          textStyle: {
            color: nameColor,
            fontFamily: name_fontFamily,
            fontSize: name_fontSize
          },
          subtextStyle: {
            fontSize: subname_fontSize,
            fontFamily: name_fontFamily
          }
        },
        grid: {
          right: '0%',
          top: '0%',
          left: '0%',
          bottom: '0%',
          x: 0,
          y: 0,
          x2: 0,
          y2: 0,
        },
        visualMap: {
          show: false,
          min: 0,
          max: 34,
          left: 'left',
          top: 'bottom',
          text: ['高', '低'], // 文本，默认为数值文本
          calculable: true,
          seriesIndex: [0],
          // 图表背景颜色
          inRange: {
            // color: ['#3B5077', '#031525'] // 蓝黑
            // color: ['#ffc0cb', '#800080'] // 红紫
            // color: ['#3C3B3F', '#605C3C'] // 黑绿
            // color: ['#0f0c29', '#302b63', '#24243e'] // 黑紫黑
            // color: ['#23074d', '#cc5333'] // 紫红
            color: ['#0846DC', '#B4F2FF'] // 蓝绿
            // color: ['#1488CC', '#2B32B2'] // 浅蓝
            // color: ['#00467F', '#A5CC82'] // 蓝绿
            // color: ['#00467F', '#A5CC82'] // 蓝绿
            // color: ['#00467F', '#A5CC82'] // 蓝绿
            // color: ['#00467F', '#A5CC82'] // 蓝绿

          }
        },
        geo: {
          show: true,
          map: mapName,
          label: {
            normal: {
              show: false
            },
            emphasis: {
              show: false,
            }
          },
          roam: false,
          itemStyle: {
            normal: {
              areaColor: '#B4F2FF',
              borderColor: '#3B5077',
            },
            // emphasis: {
            //     areaColor: '#2B91B7',
            // }
          }
        },
        series: [{
            type: 'map',
            map: mapName,
            geoIndex: 1,
            roam: false,
            // aspectScale: 0.75, //长宽比
            showLegendSymbol: false, // 存在legend时显示
            label: {
              normal: {
                show: false
              },
              emphasis: {
                show: false,
                textStyle: {
                  color: '#fff'
                }
              }
            },
            itemStyle: {
              normal: {
                areaColor: '#031525',
                borderColor: '#3B5077',
              },
              emphasis: {
                areaColor: '#2B91B7'
              }
            },
            animation: false,
            data: mapData
          },
          {
            name: 'dataList',
            type: 'map',
            map: mapName,
            geoIndex: 0,
            // aspectScale: 0.75, //长宽比
            showLegendSymbol: false, // 存在legend时显示
            roam: false,
            label: {
              normal: {
                show: false
              },
              emphasis: {
                show: false,
                textStyle: {
                  color: '#fff'
                }
              }
            },
            itemStyle: {
              normal: {
                areaColor: '#031525',
                borderColor: '#3B5077',
              },
              emphasis: {
                areaColor: '#2B91B7'
              }
            },
            animation: false,
            data: data
          },
          {
            name: '点',
            type: 'scatter',
            coordinateSystem: 'geo',
            roam: false,
            symbol: function (val) {
              if (val[2].index !== 1) {
                return 'pin';
              }
            }, //气泡 大小
            symbolSize: function (val) {
              if (val[2].index !== 1) {
                return 50;
              } else {
                return 70;
              }
            },
            label: {
              normal: {
                show: true,
                textStyle: {
                  color: '#fff',
                  fontSize: 16,
                },
                formatter: function (params) {
                  if (params.value[2].index !== 1) {
                    return params.value[2].index;
                  } else {
                    return params.name;
                  }
                },
              },

            },
            itemStyle: {
              normal: {
                color: '#C90505', //标志颜色
                borderColor: '#FFB4B4',
                borderWidth: 1,
              }
            },
            zlevel: 6,
            data: convertData(data),
          },
        ]
      };
      // 鼠标移入移出事件
      myChart.on("mouseover", function (params) {
        // 判断有数据时显示，否则隐藏
        if (params.value[2]) {
          const html = '<br/>'
          $('.tips').show().css({
            position: 'absolute',
            background: 'black',
            opacity: 0.7,
            color: '#fff',
            padding: '10px',
            'border-radius': '3px',
            left: params.event.offsetX - 60,
            top: params.event.offsetY + 20,
            'z-index': 1000
          }).html(params.name + '分行 :' + html + ' 当期' + name + '量：' + (name == '交易' ? params.value[2]
            .value : params.value[2].value))
        } else {
          $('.tips').hide()
        }
      });
      myChart.on("mouseout", function (params) {
        $('.tips').hide()
      });
      // 渲染图表
      myChart.resize();
      myChart.setOption(option, true);
    }
    // 默认渲染交易图表
    let name = '交易';
    changeData(name)

    //  窗口改变，重新渲染
    $(window).resize(function () {
      if ($('.header-title').text().indexOf('交易规模') > -1) {
        changeData('签约')
      } else {
        changeData('交易')
      }
    })
  </script>
</body>

</html>